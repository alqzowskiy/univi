<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIVI AI - Profile</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .hero-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 100%;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="glass-card fixed w-full top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex items-center">
                    <a href="/" class="flex items-center space-x-3">
                        <svg class="h-10 w-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 14l9-5-9-5-9 5 9 5z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14v7" />
                        </svg>
                        <span
                            class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">UNIVI
                            AI</span>
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="/unichooser" class="nav-link text-gray-700 hover:text-blue-600 font-medium text-lg">Find
                        Universities</a>
                    <a href="/advisor" class="nav-link text-gray-700 hover:text-blue-600 font-medium text-lg">AI
                        Advisor</a>
                    <a href="/loadquiz" class="nav-link text-gray-700 hover:text-blue-600 font-medium text-lg">Career
                        Quiz</a>
                    <a href="/gpa-calculator" class="nav-link text-gray-700 hover:text-blue-600 font-medium text-lg">GPA
                        Calculator</a>
                    <button id="logoutBtn"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Sign Out
                    </button>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button id="menuBtn" class="text-gray-500 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile menu -->
            <div id="mobileMenu" class="hidden md:hidden pb-4">
                <div class="flex flex-col space-y-4">
                    <a href="/unichooser" class="text-gray-700 hover:text-blue-600 font-medium">Find Universities</a>
                    <a href="/advisor" class="text-gray-700 hover:text-blue-600 font-medium">AI Advisor</a>
                    <a href="/loadquiz" class="text-gray-700 hover:text-blue-600 font-medium">Career Quiz</a>
                    <a href="/gpa-calculator" class="text-gray-700 hover:text-blue-600 font-medium">GPA Calculator</a>
                    <button id="mobileLogoutBtn"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Sign Out
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- User Profile Section -->
    <div class="pt-32 pb-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <!-- Profile Header -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="flex items-center space-x-6">
                    <div class="bg-blue-100 rounded-full p-4">
                        <svg class="h-12 w-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900" id="userName">Loading...</h1>
                        <p class="text-gray-500" id="userEmail">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- Target University Section -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Target University</h2>
                <div id="targetUniversityDisplay" class="mb-6">
                    <p class="text-gray-600" id="currentTarget">No target university set</p>
                </div>
                <button id="editTargetBtn"
                    class="bg-blue-100 text-blue-600 px-6 py-2 rounded-lg hover:bg-blue-200 transition-colors">
                    Edit Target University
                </button>
            </div>

            <!-- Edit Target University Modal -->
            <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
                <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Set Target University</h3>
                    <input type="text" id="targetUniversityInput"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                        placeholder="Enter university name">
                    <div class="flex justify-end space-x-4">
                        <button id="cancelEditBtn"
                            class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button id="saveTargetBtn"
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        firebase.auth().onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = '/login';
                return;
            }

            try {
                const doc = await db.collection('users').doc(user.uid).get();
                if (doc.exists) {
                    const userData = doc.data();

                    // Update UI
                    document.getElementById('userName').textContent = userData.name || 'User';
                    document.getElementById('userEmail').textContent = userData.email;

                    if (userData.targetUniversity) {
                        document.getElementById('currentTarget').textContent = userData.targetUniversity;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        });

        // Handle logout
        function handleLogout() {
            // Удаляем куки
            document.cookie = 'auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';

            firebase.auth().signOut().then(() => {
                window.location.href = '/advisor';
            }).catch((error) => {
                console.error('Error signing out:', error);
            });
        }

        // Add event listeners
        document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
        document.getElementById('mobileLogoutBtn')?.addEventListener('click', handleLogout);

        // Handle target university
        const editModal = document.getElementById('editModal');
        const editTargetBtn = document.getElementById('editTargetBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const saveTargetBtn = document.getElementById('saveTargetBtn');

        if (editTargetBtn) {
            editTargetBtn.addEventListener('click', () => {
                editModal.classList.remove('hidden');
            });
        }

        if (cancelEditBtn) {
            cancelEditBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
            });
        }

        if (saveTargetBtn) {
            saveTargetBtn.addEventListener('click', async () => {
                const user = firebase.auth().currentUser;
                if (!user) return;

                const targetUniversity = document.getElementById('targetUniversityInput').value;

                try {
                    await db.collection('users').doc(user.uid).update({
                        targetUniversity: targetUniversity
                    });

                    document.getElementById('currentTarget').textContent = targetUniversity || 'No target university set';
                    editModal.classList.add('hidden');
                } catch (error) {
                    console.error('Error updating target university:', error);
                }
            });
        }

        // Handle mobile menu
        const menuBtn = document.getElementById('menuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        if (menuBtn) {
            menuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
    </script>
</body>

</html>